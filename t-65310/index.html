<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>小蜗熊的蜂蜜罐</title>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script>if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode)) window.location.href="https://support.dmeng.net/upgrade-your-browser.html?referrer="+encodeURIComponent(window.location.href); </script>
    
    
<link rel="stylesheet" href="/css/mdui.css">
<link rel="stylesheet" href="/css/main.css">

    
<link rel="stylesheet" href="//lib.baomitu.com/font-awesome/5.11.2/css/all.min.css">


    
    
    <title>LAMP下使用Certbot自动配置SSL证书 | 小蜗熊的蜂蜜罐</title>
<meta name="generator" content="Hexo 4.2.0"></head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-blue-grey mdui-theme-accent-blue">
    
    <header class="mdui-appbar mdui-appbar-fixed">
  <div id="toolbar" class="mdui-toolbar mdui-color-theme">
    <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="mdui-icon material-icons">menu</i></a>
    <a href="/" class="mdui-typo-headline">小蜗熊的蜂蜜罐</a>
    <div class="mdui-toolbar-spacer"></div>
    <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: 'search'}"><i class="mdui-icon material-icons">search</i></a>
  </div>
</header>

<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
  
</div>

    <aside id="sidebar" class="mdui-drawer">
    <div class="mdui-tab" mdui-tab>
        <a href="#sidebar-tab1" id="sidebartab" class="mdui-ripple mdui-tab-active">导航</a>
        <a href="#sidebar-tab2" id="sidebartab" class="mdui-ripple">站点概览</a>
    </div>

    
    <div id="sidebar-tab1" class="mdui-p-a-2">
        <div class="mdui-list">
            
                
                <a href="/" class="mdui-list-item mdui-ripple">
                    <i class="mdui-list-item-icon mdui-icon material-icons">home</i>
                    <div class="mdui-list-item-content">主页</div>
                </a>
            
                
                <a href="/tags/" class="mdui-list-item mdui-ripple">
                    <i class="mdui-list-item-icon mdui-icon material-icons">bookmark</i>
                    <div class="mdui-list-item-content">标签</div>
                </a>
            
                
                <a href="/categories/" class="mdui-list-item mdui-ripple">
                    <i class="mdui-list-item-icon mdui-icon material-icons">folder</i>
                    <div class="mdui-list-item-content">分类</div>
                </a>
            
                
                <a href="/archives/" class="mdui-list-item mdui-ripple">
                    <i class="mdui-list-item-icon mdui-icon material-icons">archive</i>
                    <div class="mdui-list-item-content">归档</div>
                </a>
            
                
                <a href="/NMSL/" class="mdui-list-item mdui-ripple">
                    <i class="mdui-list-item-icon mdui-icon material-icons">attach_money</i>
                    <div class="mdui-list-item-content">抽象话转换器</div>
                </a>
            
                
                <a href="/sitemap.xml" class="mdui-list-item mdui-ripple">
                    <i class="mdui-list-item-icon mdui-icon material-icons">map</i>
                    <div class="mdui-list-item-content">站点地图</div>
                </a>
            
            <div class="mdui-list-item mdui-ripple">
                <i class="mdui-list-item-icon mdui-icon material-icons">brightness_2</i>
                <div class="mdui-list-item-content">夜间模式</div>
                <label class="mdui-switch" id="darkmode">
                  <input type="checkbox" id="nightmode_switch"/>
                  <i class="mdui-switch-icon"></i>
                </label>
            </div>           
        </div>
    </div>

    
    <div id="sidebar-tab2" class="mdui-p-a-2">
        <div class="sidebar-avatar">
            <img src="/images/avatar.jpg"/>
            <p class="sidebar-author-name">机智小蜗熊</p>
            <p class="sidebar-description">有害辣鸡</p>
        </div>

        <div class="sidebar-links">
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="fab fa-github"></i></span>
                    <a href="https://github.com/kb1000fx" target="_blank" rel="noopener" class="mdui-chip-title">GitHub</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="fab fa-steam"></i></span>
                    <a href="https://steamcommunity.com/profiles/76561198346798163" target="_blank" rel="noopener" class="mdui-chip-title">Steam</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="fas fa-envelope"></i></span>
                    <a href="mailto:kb1000fx@gmail.com" class="mdui-chip-title">E-Mail</a>
                </div>
            
        </div>
    </div>

    <div class="mdui-divider"></div>
    
    
    
        <div class="adsense-contain">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Sidebar Ads -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5888225880131847"
     data-ad-slot="4752632688"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        </div>
    
    
</aside>
    
    <main id="main-contain" class="mdui-container mdui-m-t-5">
      <article id="article" class="mdui-card mdui-p-a-2 mdui-m-b-5">
  
  
    
  

  <header class="mdui-card-media">
    
    
      
        <img src = /images/65310/certbot-logo.png >
      
      <div class="mdui-card-media-covered">
        <div class="post-header"> 
  <a class="post-header-title" href="/t-65310/">LAMP下使用Certbot自动配置SSL证书</a>
  <div class="post-header-meta">
    <span>
      <i class="fa fa-calendar"></i>
      发布于:&nbsp;2018-03-01
    </span>
    <span>
      <i class="fa fa-calendar-check"></i>
      更新于:&nbsp;2020-02-10
    </span>
    <span>
      <i class="fa fa-folder"></i>
      分类于:&nbsp;<a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a> > <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/Linux/">Linux</a>
    </span>
    
      <span>
        <i class="fa fa-eye"></i>
        阅读次数:&nbsp;
        <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
      </span>
    
  </div>
</div>   
    



      </div>
    
      
    
    <div class="mdui-card-menu">
    
      <button class="mdui-btn mdui-btn-icon mdui-text-color-teal" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="mdui-icon material-icons">share</i></button>
      <ul class="mdui-menu" id="share_menu">
        <li class="mdui-menu-item">
          <a href="http://service.weibo.com/share/share.php?appkey=&title=LAMP下使用Certbot自动配置SSL证书&url=https://garybear.cn/t-65310/&pic=https://garybear.cn/images/favicon.png&searchPic=false&style=simple" target="_blank" class="mdui-ripple">分享到 Weibo</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://twitter.com/intent/tweet?text=LAMP下使用Certbot自动配置SSL证书&url=https://garybear.cn/t-65310/&via=机智小蜗熊" target="_blank" class="mdui-ripple">分享到 Twitter</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.facebook.com/sharer/sharer.php?u=https://garybear.cn/t-65310/" target="_blank" class="mdui-ripple">分享到 Facebook</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://plus.google.com/share?url=https://garybear.cn/t-65310/" target="_blank" class="mdui-ripple">分享到 Google+</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://garybear.cn/t-65310/&title=LAMP下使用Certbot自动配置SSL证书" target="_blank" class="mdui-ripple">分享到 LinkedIn</a>
        </li>
        <li class="mdui-menu-item">
          <a href="http://connect.qq.com/widget/shareqq/index.html?site=小蜗熊的蜂蜜罐&title=LAMP下使用Certbot自动配置SSL证书&summary=有害辣鸡&pics=https://garybear.cn/images/favicon.png&url=https://garybear.cn/t-65310/" target="_blank" class="mdui-ripple">分享到 QQ</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://telegram.me/share/url?url=https://garybear.cn/t-65310/&text=LAMP下使用Certbot自动配置SSL证书" target="_blank" class="mdui-ripple">分享到 Telegram</a>
        </li>
      </ul>
    
  </div>
  </header>

  
  
    <div class="adsense-contain">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Banner Ads -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5888225880131847"
     data-ad-slot="3949852758"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>
  

  
  

  <div class="mdui-card-content mdui-typo">
    <h1 id="LAMP下使用Certbot自动配置SSL证书"><a href="#LAMP下使用Certbot自动配置SSL证书" class="headerlink" title="LAMP下使用Certbot自动配置SSL证书"></a>LAMP下使用Certbot自动配置SSL证书</h1><p>Let’s Encrypt是ISRG运营一个免费、开放，自动化的证书颁发机构，可以申请到期限90天的免费SSL证书（包括单域名、多域名和泛域名）。 Certbot是Let’s Encrypt官方提供的一款SSL自动安装程序，<a href="https://certbot.eff.org/" target="_blank" rel="noopener">官方网站</a> 。使用Certbot可以自动完成获取密钥、申请证书、安装证书等一系列繁琐的操作，也提供了自动证书续期的功能。使用Certbot自动配置SSL证书，也可以免去手动申请证书中添加TXT解析的步骤。</p>
<p><img src="/images/certbot-logo.png" alt=""></p>
<h2 id="安装Certbot客户端"><a href="#安装Certbot客户端" class="headerlink" title="安装Certbot客户端"></a>安装Certbot客户端</h2><h3 id="方法一-Packages-for-Debian"><a href="#方法一-Packages-for-Debian" class="headerlink" title="方法一 (Packages for Debian)"></a>方法一 (Packages for Debian)</h3><p>Ubuntu下可以直接用预编译好的安装包进行安装，步骤如下： </p>
<pre><code>sudo apt-get update
sudo apt-get install software-properties-common  
sudo add-apt-repository ppa:certbot/certbot  
sudo apt-get update  
sudo apt-get install python-certbot-apache</code></pre><p>安装后可执行<code>certbot</code>来检验是否安装成功。 </p>
<h3 id="方法二-Certbot-Auto"><a href="#方法二-Certbot-Auto" class="headerlink" title="方法二 (Certbot-Auto)"></a>方法二 (Certbot-Auto)</h3><p>如果源出现问题无法使用apt-get进行安装，或者是当前系统linux版本没有对应的certbot安装包时(如CentOS6等)，可采用方法二。 CentOS6用此方法安装前还需要更新Python。 </p>
<pre><code>git clone https://github.com/certbot/certbot.git
chmod a+x certbot-auto</code></pre><p>从GitHub获取Cerbot-Auto并赋予权限 </p>
<pre><code>./certbot-auto</code></pre><p>自动安装当前环境下所需的依赖 <code>如采用此方法安装，请把下文中的 certbot 全改成./certbot-auto</code></p>
<h2 id="配置SSL证书"><a href="#配置SSL证书" class="headerlink" title="配置SSL证书"></a>配置SSL证书</h2><h3 id="1-停止Apache服务"><a href="#1-停止Apache服务" class="headerlink" title="1. 停止Apache服务"></a>1. 停止Apache服务</h3><pre><code>sudo /etc/init.d/apache2 stop</code></pre><h3 id="2-生成SSL证书"><a href="#2-生成SSL证书" class="headerlink" title="2. 生成SSL证书"></a>2. 生成SSL证书</h3><p>单证书对应单域名的情况下，可以使用： </p>
<pre><code>sudo certbot –apache -d [your domain]</code></pre><p>在单证书对应多个域名的情况下，可以在其后加上多个 <code>-d [your domain]</code> , 其中第一个一般为主域名。 </p>
<pre><code>sudo certbot –apache -d [your domain1] -d [your domain2] ···</code></pre><p>运行时会有一个交互过程，根据提示输入邮箱地址并进行验证，这个邮箱可以用来恢复丢失的密钥和接收通知。 最后会有一个选项，选择同时开启http和https或者是全部重定向到https，建议全部重定向。 </p>
<h3 id="3-启动Apache服务"><a href="#3-启动Apache服务" class="headerlink" title="3. 启动Apache服务"></a>3. 启动Apache服务</h3><pre><code>sudo /etc/init.d/apache2 start</code></pre><h2 id="Certbot自动更新"><a href="#Certbot自动更新" class="headerlink" title="Certbot自动更新"></a>Certbot自动更新</h2><p>Let’s Encrypt颁发的证书期限只有90天，所以需要定期进行更新。<br>首先可以通过<code>sudo certbot renew –dry-run</code>命令进行验证，确保certbot可以进行证书更新。然后可以借助Cron使其自动执行更新任务。<br>Cron是一个定时执行工具，作用类似于windows下的计划任务，具体操作如下：<br>使用命令<code>cron -l</code>或直接编辑/etc/crontab文件 </p>
<pre><code>0 3 1 * * certbot renew --pre-hook &quot;/etc/init.d/apache2 stop&quot; --post-hook &quot;/etc/init.d/apache2 start&quot;</code></pre><p><code>cron -l</code> 后出现刚添加的内容，即为设置成功。 </p>
<h2 id="可能出现的问题"><a href="#可能出现的问题" class="headerlink" title="可能出现的问题"></a>可能出现的问题</h2><h3 id="python虚拟环境问题"><a href="#python虚拟环境问题" class="headerlink" title="python虚拟环境问题"></a>python虚拟环境问题</h3><p>在低内存的VPS上运行certbot可能会出现依赖安装失败，可以通过杀死其他程序来释放内存，经测试可用内存在120m时运行失败，通过kill命令释放至500m可用时即可正常运行。<br>如果主机内存物理内存本身即小于512m，可采用创建临时交换文件的方法： </p>
<pre><code>sudo fallocate -l 1G /tmp/swapfile
sudo chmod 600 /tmp/swapfile
sudo mkswap /tmp/swapfile
sudo swapon /tmp/swapfile</code></pre><p>安装结束后用以下命令删除交换文件： </p>
<pre><code>sudo swapoff /tmp/swapfile
sudo rm /tmp/swapfile</code></pre><h3 id="Chrome下无法显示小绿锁"><a href="#Chrome下无法显示小绿锁" class="headerlink" title="Chrome下无法显示小绿锁"></a>Chrome下无法显示小绿锁</h3><p>Chrome下显示小绿锁需要页面内全部资源均为HTTPS资源，否则会显示“您与此网站之间建立的链接并非完全安全”。 如果添加完SSL证书后仍未显示绿锁，需要检查网页内的资源并将其改为HTTPS。包括对象储存服务、网页内图片以及外链图片。</p>

  </div>
  
  <!--文末结束语-->
  
    <div style="text-align:center;color: #ccc;font-size:24px;"> --- 本文结束 <i class="fa fa-heartbeat"></i> The End --- </div>
  
  
  <!--页脚广告-->
  
    <div class="adsense-contain">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Footer Ads -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5888225880131847"
     data-ad-slot="2212253348"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>
  

  <div class="mdui-divider-inset"></div>

  
  <nav >
    
      <a rel="prev" class="post-nav-item mdui-float-left" href="/t-65147/">
        <i class="fa fa-chevron-left"></i>
        <span>htaccess文件格式</span>
      </a>
    
    
      <a rel="next" class="post-nav-item mdui-float-right" href="/t-33478/">
        <span>Ubuntu16.04下的LAMP环境搭建</span>
        <i class="fa fa-chevron-right"></i>
      </a>
    
  </nav>
</article>




  <div class="toc-button">
    <button class="mdui-fab mdui-ripple mdui-color-teal" mdui-menu="{target: '#toc'}"><i class="mdui-icon material-icons">format_list_numbered</i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item">
        <a href="/t-65310/" id="toc-header" class="mdui-ripple">文章目录</a>

        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#LAMP下使用Certbot自动配置SSL证书"><span class="toc-number">1.</span> <span class="toc-text">LAMP下使用Certbot自动配置SSL证书</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Certbot客户端"><span class="toc-number">1.1.</span> <span class="toc-text">安装Certbot客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方法一-Packages-for-Debian"><span class="toc-number">1.1.1.</span> <span class="toc-text">方法一 (Packages for Debian)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方法二-Certbot-Auto"><span class="toc-number">1.1.2.</span> <span class="toc-text">方法二 (Certbot-Auto)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置SSL证书"><span class="toc-number">1.2.</span> <span class="toc-text">配置SSL证书</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-停止Apache服务"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 停止Apache服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-生成SSL证书"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. 生成SSL证书</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-启动Apache服务"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. 启动Apache服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Certbot自动更新"><span class="toc-number">1.3.</span> <span class="toc-text">Certbot自动更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可能出现的问题"><span class="toc-number">1.4.</span> <span class="toc-text">可能出现的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#python虚拟环境问题"><span class="toc-number">1.4.1.</span> <span class="toc-text">python虚拟环境问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Chrome下无法显示小绿锁"><span class="toc-number">1.4.2.</span> <span class="toc-text">Chrome下无法显示小绿锁</span></a></li></ol></li></ol></li></ol>
      </li>
    </ul>
  </div>




  <div id="comment" class="mdui-card mdui-p-a-2 mdui-m-b-5">
    <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  var gitalk = new Gitalk({
    clientID: 'f3866882707e12e74c4a',
    clientSecret: '04a037afee00b94e4b55e474aa270ac136a8c952',
    repo: 'kb1000fx.github.io',
    owner: 'kb1000fx',
    admin: ['kb1000fx'],
    id: '' || md5(location.pathname),
    distractionFreeMode: 'true',
  });
  gitalk.render('gitalk-container');
</script>
  </div>

    </main>
    <footer id="footer" class="mdui-m-t-5 mdui-p-y-3 mdui-color-theme">
  <div class="mdui-p-y-1 mdui-text-center">
    Copyright &copy; 2015 - 2020 机智小蜗熊<br>
    Powered by <a href="https://hexo.io/" target="_blank" class="mdui-text-color-theme-accent">Hexo</a>
    
      <br>
      <span id="busuanzi_container_site_uv" style="display: none;"><i class="mdui-icon material-icons">&#xe7fd;</i> <span id="busuanzi_value_site_uv"></span></span>
      <span id="busuanzi_container_site_pv" style="display: none;"><i class="mdui-icon material-icons">&#xe417;</i> <span id="busuanzi_value_site_pv"></span></span>
      
    
  </div>
</footer>
    
    <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-teal"><i class="mdui-icon material-icons">arrow_upward</i></button>
    
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
<script src="/js/mdui.js"></script>
<script src="/js/meadow.js"></script>

</body>
</html >